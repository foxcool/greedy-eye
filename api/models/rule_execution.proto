syntax = "proto3";

package models;

import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";

option go_package = "github.com/foxcool/greedy-eye/internal/api/models";

// RuleExecution represents a single execution of a rule
message RuleExecution {
  string id = 1;
  string rule_id = 2;
  
  // Optional scope - inherited from rule if not specified
  optional string portfolio_id = 3;
  optional string user_id = 4;
  
  google.protobuf.Timestamp started_at = 5;
  google.protobuf.Timestamp completed_at = 6;
  ExecutionStatus status = 7;
  optional string error_message = 8;
  
  // Results produced by execution
  repeated string created_transaction_ids = 9;
  repeated string affected_holding_ids = 10;
  
  // Execution metrics
  int32 transactions_created = 11;
  google.protobuf.Struct execution_summary = 12; // Rule-type specific execution details
}

// ExecutionStatus indicates the status of a rule execution
enum ExecutionStatus {
  EXECUTION_STATUS_UNKNOWN = 0;
  EXECUTION_STATUS_PENDING = 1;
  EXECUTION_STATUS_IN_PROGRESS = 2;
  EXECUTION_STATUS_COMPLETED = 3;
  EXECUTION_STATUS_FAILED = 4;
  EXECUTION_STATUS_CANCELLED = 5;
}



// Note: Rule execution summaries are stored in flexible google.protobuf.Struct format
// for maximum adaptability as different rule types evolve