syntax = "proto3";

package models;

import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";

option go_package = "github.com/foxcool/greedy-eye/internal/api/models";

// RuleExecution represents a single execution of a rule
message RuleExecution {
  string id = 1;
  string rule_id = 2;
  string portfolio_id = 3;
  string user_id = 4;
  google.protobuf.Timestamp started_at = 5;
  google.protobuf.Timestamp completed_at = 6;
  ExecutionStatus status = 7;
  string error_message = 8;
  google.protobuf.Struct execution_context = 9; // Context at execution time
  repeated ExecutionStep steps = 10;
  ExecutionSummary summary = 11;
}

// ExecutionStatus indicates the status of a rule execution
enum ExecutionStatus {
  EXECUTION_STATUS_UNKNOWN = 0;
  EXECUTION_STATUS_PENDING = 1;
  EXECUTION_STATUS_IN_PROGRESS = 2;
  EXECUTION_STATUS_COMPLETED = 3;
  EXECUTION_STATUS_FAILED = 4;
  EXECUTION_STATUS_CANCELLED = 5;
}

// ExecutionStep represents a single step in rule execution
message ExecutionStep {
  string step_id = 1;
  string name = 2;
  string description = 3;
  google.protobuf.Timestamp started_at = 4;
  google.protobuf.Timestamp completed_at = 5;
  ExecutionStatus status = 6;
  string error_message = 7;
  google.protobuf.Struct input_data = 8;
  google.protobuf.Struct output_data = 9;
  repeated string log_messages = 10;
}

// ExecutionSummary provides a summary of the execution results
message ExecutionSummary {
  int32 total_steps = 1;
  int32 successful_steps = 2;
  int32 failed_steps = 3;
  int64 duration_ms = 4;
  
  // Flexible summary data - adapts to any rule type
  google.protobuf.Struct summary = 5;
}

// Note: Rule execution summaries are stored in flexible google.protobuf.Struct format
// for maximum adaptability as different rule types evolve