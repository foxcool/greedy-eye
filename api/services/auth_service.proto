syntax = "proto3";

package services;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "google/api/annotations.proto";
import "api/models/api_key.proto";

option go_package = "github.com/foxcool/greedy-eye/internal/api/services";

// AuthService provides authentication and authorization business logic
// For API Key CRUD operations, use StorageService
service AuthService {
  
  // JWT management
  rpc CreateJWT(CreateJWTRequest) returns (CreateJWTResponse) {
    option (google.api.http) = {
      post: "/api/v1/auth/jwt/create"
      body: "*"
    };
  }
  
  rpc ValidateJWT(ValidateJWTRequest) returns (ValidateJWTResponse) {
    option (google.api.http) = {
      post: "/api/v1/auth/jwt/validate"
      body: "*"
    };
  }
  
  rpc RefreshJWT(RefreshJWTRequest) returns (RefreshJWTResponse) {
    option (google.api.http) = {
      post: "/api/v1/auth/jwt/refresh"
      body: "*"
    };
  }
  
}



// JWT messages
message CreateJWTRequest {
  string user_id = 1;
  repeated string scopes = 2;
  int64 expires_in_seconds = 3;
  string api_key_id = 4; // Reference to API key used for authentication
}

message CreateJWTResponse {
  string access_token = 1;
  string refresh_token = 2;
  int64 expires_in = 3;
  string token_type = 4;
}

message ValidateJWTRequest {
  string token = 1;
  repeated string required_scopes = 2;
}

message ValidateJWTResponse {
  bool valid = 1;
  string user_id = 2;
  repeated string scopes = 3;
  google.protobuf.Timestamp expires_at = 4;
  string error_message = 5;
}

message RefreshJWTRequest {
  string refresh_token = 1;
}

message RefreshJWTResponse {
  string access_token = 1;
  string refresh_token = 2;
  int64 expires_in = 3;
}


// Common scope definitions
enum Scope {
  SCOPE_UNKNOWN = 0;
  SCOPE_READ = 1;
  SCOPE_WRITE = 2;
  SCOPE_TRADE = 3;
  SCOPE_ADMIN = 4;
}

// Scope categories
enum ScopeCategory {
  SCOPE_CATEGORY_UNKNOWN = 0;
  SCOPE_CATEGORY_USER = 1;
  SCOPE_CATEGORY_PORTFOLIO = 2;
  SCOPE_CATEGORY_ASSET = 3;
  SCOPE_CATEGORY_PRICE = 4;
  SCOPE_CATEGORY_RULE = 5;
  SCOPE_CATEGORY_INTEGRATION = 6;
} 